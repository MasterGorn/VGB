<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Movement Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="public/data/pieces.js"></script>
    <script src="public/js/movement-demo.js"></script>
</head>
<body>
    <h1>Test Movement Demo avec Dossiers</h1>
    <button id="testBtn">Tester Movement Demo</button>
    <div id="result"></div>

    <script>
        document.getElementById('testBtn').addEventListener('click', async function() {
            try {
                console.log('üß™ Test Movement Demo...');
                
                // V√©rifier que piecesData est charg√©
                if (typeof piecesData === 'undefined') {
                    throw new Error('piecesData non disponible');
                }
                
                console.log('Pi√®ces disponibles:', piecesData.length);
                console.log('Factions:', [...new Set(piecesData.map(p => p.faction))]);
                
                // Cr√©er une instance de MovementDemo
                const demo = new MovementDemo();
                demo.pieces = piecesData.slice(0, 3); // Prendre seulement 3 pi√®ces pour le test
                
                console.log('Pi√®ces pour le test:', demo.pieces.map(p => p.name));
                
                // Tester la cr√©ation de l'archive
                const zip = new JSZip();
                
                // Cr√©er les dossiers
                const factions = [...new Set(demo.pieces.map(p => p.faction))];
                console.log('Factions √† cr√©er:', factions);
                
                factions.forEach(faction => {
                    const folder = faction.toLowerCase();
                    zip.folder(folder);
                    zip.file(`${folder}/README.txt`, `Test - ${faction}`);
                    console.log(`‚úì Dossier cr√©√©: ${folder}/`);
                });
                
                // Ajouter quelques fichiers de test
                demo.pieces.forEach(piece => {
                    const folder = piece.faction.toLowerCase();
                    const fileName = piece.name.toLowerCase().replace(/\s+/g, '-');
                    zip.file(`${folder}/${fileName}-test.png`, 'fake-image-data');
                    console.log(`‚úì Fichier ajout√©: ${folder}/${fileName}-test.png`);
                });
                
                console.log('üìÅ Fichiers dans l\'archive de test:');
                Object.keys(zip.files).forEach(filePath => {
                    console.log(`  - ${filePath}`);
                });
                
                // G√©n√©rer et t√©l√©charger
                const content = await zip.generateAsync({type: "blob"});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'test-movement-demo.zip';
                link.click();
                
                document.getElementById('result').innerHTML = `
                    <h2>‚úÖ Test Movement Demo r√©ussi !</h2>
                    <p>Archive cr√©√©e avec ${Object.keys(zip.files).length} fichiers</p>
                    <p>V√©rifiez l'archive pour voir les dossiers par faction.</p>
                `;
                
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('result').innerHTML = `<h2>‚ùå Erreur: ${error.message}</h2>`;
            }
        });
    </script>
</body>
</html>
