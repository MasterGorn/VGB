<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Chesstendo - Les pièces</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="public/css/header.css" />
<link rel="stylesheet" href="public/css/common.css" />
<link rel="stylesheet" href="public/css/global.css" />
<style>
/* Styles spécifiques à la page des pièces */
.pieces-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:20px; margin:20px 0; }
.piece-card { background:var(--card-bg); border:1px solid var(--border-color); border-radius:10px; padding:20px; text-align:center; box-shadow:var(--shadow-light); transition:transform 0.3s ease, box-shadow 0.3s ease; }
.piece-card:hover { transform:translateY(-4px); box-shadow:var(--shadow-medium); }
.piece-image { width:100%; max-width:200px; height:auto; border-radius:8px; margin-bottom:16px; }
.piece-name { font-size:18px; font-weight:bold; margin-bottom:8px; color:var(--text-primary); }
.piece-description { color:var(--text-secondary); font-size:12px; line-height:1.4; }

/* Badges spécifiques */
.badge.nintendo { background:var(--accent-red); }
.badge.playstation { background:var(--accent-purple); }
.badge.sega { background:var(--accent-blue); }
.badge.xbox { background:var(--accent-green); }
.badge.cost { background:#28a745; }
.badge.tier { background:#ffc107; color:#000; }
.badge.range { background:#6f42c1; }

/* Filtres actifs */
.active-filters { margin:16px 0; display:flex; gap:8px; flex-wrap:wrap; }
.filter-tag { background:var(--secondary-bg); color:var(--text-primary); padding:4px 8px; border-radius:16px; font-size:12px; display:flex; align-items:center; gap:4px; border:1px solid var(--border-color); }
.filter-tag .remove { cursor:pointer; font-weight:bold; }
</style>
</head>
<body>
<div id="header-root"></div>

<main class="site-main">
  <h1 class="page-title">♟️ <span class="title-text" data-t="available-pieces">Pièces disponibles</span> ♟️</h1>
  
  <!-- Contrôles de tri et filtrage -->
  <div class="controls">
    <div class="control-group">
      <label for="sortBy" data-t="sort-by">Trier par :</label>
      <select id="sortBy" class="form-control">
        <option value="name" data-t="name">Nom</option>
        <option value="cost" data-t="cost">Coût</option>
        <option value="tier" data-t="strength">Force</option>
        <option value="faction" data-t="editor">Éditeur</option>
        <option value="universe" data-t="universe">Univers</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="factionFilter" data-t="editor">Éditeur :</label>
      <select id="factionFilter" class="form-control">
        <option value="" data-t="all">Tous</option>
        <option value="Nintendo" data-t="nintendo">Nintendo</option>
        <option value="PlayStation" data-t="playstation">PlayStation</option>
        <option value="SEGA" data-t="sega">SEGA</option>
        <option value="Xbox" data-t="xbox">Xbox</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="universeFilter" data-t="universe">Univers :</label>
      <select id="universeFilter" class="form-control">
        <option value="" data-t="all">Tous</option>
        <option value="Super Mario" data-t="super-mario">Super Mario</option>
        <option value="The Legend of Zelda" data-t="legend-of-zelda">The Legend of Zelda</option>
        <option value="Metroid" data-t="metroid">Metroid</option>
        <option value="Kid Icarus" data-t="kid-icarus">Kid Icarus</option>
        <option value="Sonic" data-t="sonic">Sonic</option>
        <option value="Streets of Rage" data-t="streets-of-rage">Streets of Rage</option>
        <option value="Halo" data-t="halo">Halo</option>
        <option value="Gears of War" data-t="gears-of-war">Gears of War</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="tierFilter" data-t="strength">Force :</label>
      <select id="tierFilter" class="form-control">
        <option value="" data-t="all-strengths">Toutes</option>
        <option value="1" data-t="weak">Faible</option>
        <option value="2" data-t="medium">Moyen</option>
        <option value="3" data-t="strong">Fort</option>
        <option value="4" data-t="unique">Unique</option>
      </select>
    </div>
  </div>
  
  <!-- Filtres actifs -->
  <div id="activeFilters" class="active-filters"></div>
  
  <!-- Grille des pièces -->
  <div id="piecesGrid" class="pieces-grid">  </div>
</main>

<script src="public/js/translations.js"></script>
<script src="public/js/header.js"></script>
<script src="public/data/pieces.js"></script>
<script>
// Les données des pièces sont maintenant importées depuis pieces.js

// Variables globales
let currentSort = 'name';
let currentFilters = {
  faction: '',
  universe: '',
  tier: ''
};

// Fonction pour afficher les pièces
function displayPieces(pieces) {
  const grid = document.getElementById('piecesGrid');
  grid.innerHTML = '';
  
  pieces.forEach(piece => {
    const card = document.createElement('div');
    card.className = 'piece-card';
    
    // Obtenir le chemin de l'image de démonstration
    const demoImagePath = getMovementDemoImage(piece);
    
    card.innerHTML = `
      <img src="${piece.image}" alt="${t(piece.nameKey || piece.name)}" class="piece-image" onerror="this.style.display='none'">
      <div class="piece-name">${t(piece.nameKey || piece.name)}</div>
      <div class="piece-description">${t(piece.descriptionKey || piece.description)}</div>
      <div style="margin-top: 12px;">
        <span class="badge ${piece.faction.toLowerCase()}" data-t="${piece.faction.toLowerCase()}">${piece.faction}</span>
        <span class="badge">${t(piece.universeKey || piece.universe)}</span>
        <span class="badge tier" data-t="tier-${piece.tier}">${getTierLabel(piece.tier)}</span>
        <span class="badge cost">${t('cost')}: ${piece.cost} ${t('points')}</span>
        <span class="badge range">${t('range')}: ${piece.range}</span>
      </div>
      <div class="moves" style="margin-top: 8px; font-size: 11px; color: var(--text-muted);">
        <strong data-t="movements">${t('movements')}:</strong> ${getMovesDescription(piece.moves)}
      </div>
      <div class="movement-demo" style="margin-top: 8px; text-align: center;">
        <img src="${demoImagePath}" alt="Démonstration de mouvement" style="width: 120px; height: 120px; border: 1px solid var(--border-color); border-radius: 4px;" onerror="this.style.display='none'">
        <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;" data-t="movement-demo">${t('movement-demo')}</div>
      </div>
    `;
    
    grid.appendChild(card);
  });
  
  // Mettre à jour seulement les éléments statiques, pas les valeurs dynamiques
  if (typeof updateAllTexts === 'function') {
    // Ne pas appeler updateAllTexts() car cela écrase les valeurs dynamiques
    // Les traductions sont déjà appliquées dans le HTML généré
  }
}

// Fonction pour obtenir la description des mouvements
function getMovesDescription(moves) {
  if (moves.length === 8) {
    return t('all-directions');
  }
  return `${moves.length} ${t('directions-possible')}`;
}

// Fonction pour obtenir le libellé du tier
function getTierLabel(tier) {
  const labels = {
    1: t('weak'),
    2: t('medium'), 
    3: t('strong'),
    4: t('unique')
  };
  return labels[tier] || t('unknown');
}

// Fonction pour obtenir le chemin de l'image de démonstration
function getMovementDemoImage(piece) {
  // Extraire le nom de fichier de l'image du personnage
  let fileName = piece.name;
  if (piece.image) {
    const imagePath = piece.image;
    const imageName = imagePath.split('/').pop().split('.')[0];
    fileName = imageName;
  }
  
  // Convertir en minuscules et remplacer les espaces par des tirets
  fileName = fileName.toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/[^a-z0-9-]/g, '');
  
  // Construire le chemin vers l'image de démonstration
  const faction = piece.faction.toLowerCase();
  return `public/images/${faction}/demo/${fileName}-movement-demo.png`;
}

// Fonction pour obtenir la description du tier
function getTierDescription(tier) {
  const descriptions = {
    1: "Faible - Facile à utiliser",
    2: "Moyen - Équilibré", 
    3: "Fort - Puissant mais coûteux",
    4: "Unique - Légendaire"
  };
  return descriptions[tier] || "Force inconnue";
}

// Fonction pour obtenir la couleur de faction
function getFactionColor(faction) {
  const colors = {
    'Nintendo': '#e60012',
    'PlayStation': '#003087', 
    'SEGA': '#0089cf',
    'Xbox': '#107c10'
  };
  return colors[faction] || '#666';
}

// Fonction pour obtenir la couleur d'univers
function getUniverseColor(universe) {
  const colors = {
    'Super Mario': '#e60012',
    'The Legend of Zelda': '#0066cc',
    'Metroid': '#8b4513',
    'Kid Icarus': '#ffd700',
    'Sonic': '#0089cf',
    'Streets of Rage': '#ff4500',
    'Halo': '#107c10',
    'Gears of War': '#8b4513'
  };
  return colors[universe] || '#666';
}

// Fonction pour appliquer les filtres et le tri
function applyFiltersAndSort() {
  let filteredPieces = [...piecesData];
  
  // Appliquer les filtres
  if (currentFilters.faction) {
    filteredPieces = filteredPieces.filter(piece => piece.faction === currentFilters.faction);
  }
  if (currentFilters.universe) {
    filteredPieces = filteredPieces.filter(piece => piece.universe === currentFilters.universe);
  }
  if (currentFilters.tier) {
    filteredPieces = filteredPieces.filter(piece => piece.tier.toString() === currentFilters.tier);
  }
  
  // Appliquer le tri
  filteredPieces.sort((a, b) => {
    switch(currentSort) {
      case 'name':
        return a.name.localeCompare(b.name);
      case 'cost':
        return a.cost - b.cost;
      case 'tier':
        return a.tier - b.tier;
      case 'faction':
        return a.faction.localeCompare(b.faction);
      case 'universe':
        return a.universe.localeCompare(b.universe);
      default:
        return 0;
    }
  });
  
  displayPieces(filteredPieces);
  updateActiveFilters();
}

// Fonction pour mettre à jour l'affichage des filtres actifs
function updateActiveFilters() {
  const container = document.getElementById('activeFilters');
  container.innerHTML = '';
  
  Object.entries(currentFilters).forEach(([key, value]) => {
    if (value) {
      const tag = document.createElement('div');
      tag.className = 'filter-tag';
      
      // Afficher les bons libellés
      let displayKey = key;
      let displayValue = value;
      
      if (key === 'faction') {
        displayKey = t('editor');
      } else if (key === 'tier') {
        displayKey = t('strength');
        displayValue = getTierLabel(parseInt(value));
      }
      
      tag.innerHTML = `
        ${displayKey}: ${displayValue} 
        <span class="remove" onclick="removeFilter('${key}')">×</span>
      `;
      container.appendChild(tag);
    }
  });
}

// Fonction pour supprimer un filtre
function removeFilter(filterType) {
  currentFilters[filterType] = '';
  document.getElementById(filterType + 'Filter').value = '';
  applyFiltersAndSort();
}

// Fonction pour effacer tous les filtres
function clearAllFilters() {
  currentFilters = { faction: '', universe: '', tier: '' };
  document.getElementById('factionFilter').value = '';
  document.getElementById('universeFilter').value = '';
  document.getElementById('tierFilter').value = '';
  applyFiltersAndSort();
}

// Événements
document.getElementById('sortBy').addEventListener('change', (e) => {
  currentSort = e.target.value;
  applyFiltersAndSort();
});

document.getElementById('factionFilter').addEventListener('change', (e) => {
  currentFilters.faction = e.target.value;
  applyFiltersAndSort();
});

document.getElementById('universeFilter').addEventListener('change', (e) => {
  currentFilters.universe = e.target.value;
  applyFiltersAndSort();
});

document.getElementById('tierFilter').addEventListener('change', (e) => {
  currentFilters.tier = e.target.value;
  applyFiltersAndSort();
});

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  VGBHeader.injectHeader('pieces');
  initTranslation(); // Initialiser les traductions
  applyFiltersAndSort();
});
</script>
</body>
</html>