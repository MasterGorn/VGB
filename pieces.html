<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Chesstendo - Les pièces</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="public/css/header.css" />
<link rel="stylesheet" href="public/css/common.css" />
<style>
/* Styles spécifiques à la page des pièces */
.pieces-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:20px; margin:20px 0; }
.piece-card { background:var(--card-bg); border:1px solid var(--border-color); border-radius:10px; padding:20px; text-align:center; box-shadow:var(--shadow-light); transition:transform 0.3s ease, box-shadow 0.3s ease; }
.piece-card:hover { transform:translateY(-4px); box-shadow:var(--shadow-medium); }
.piece-image { width:100%; max-width:200px; height:auto; border-radius:8px; margin-bottom:16px; }
.piece-name { font-size:18px; font-weight:bold; margin-bottom:8px; color:var(--text-primary); }
.piece-description { color:var(--text-secondary); font-size:12px; line-height:1.4; }

/* Badges spécifiques */
.badge.nintendo { background:var(--accent-red); }
.badge.playstation { background:var(--accent-purple); }
.badge.sega { background:var(--accent-blue); }
.badge.xbox { background:var(--accent-green); }
.badge.cost { background:#28a745; }
.badge.tier { background:#ffc107; color:#000; }
.badge.range { background:#6f42c1; }

/* Filtres actifs */
.active-filters { margin:16px 0; display:flex; gap:8px; flex-wrap:wrap; }
.filter-tag { background:var(--secondary-bg); color:var(--text-primary); padding:4px 8px; border-radius:16px; font-size:12px; display:flex; align-items:center; gap:4px; border:1px solid var(--border-color); }
.filter-tag .remove { cursor:pointer; font-weight:bold; }
</style>
</head>
<body>
<div id="header-root"></div>

<main class="site-main">
  <h1 class="page-title">♟️ <span class="title-text">Pièces disponibles</span> ♟️</h1>
  
  <!-- Contrôles de tri et filtrage -->
  <div class="controls">
    <div class="control-group">
      <label for="sortBy">Trier par :</label>
      <select id="sortBy" class="form-control">
        <option value="name">Nom</option>
        <option value="cost">Coût</option>
        <option value="tier">Force</option>
        <option value="faction">Éditeur</option>
        <option value="universe">Univers</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="factionFilter">Éditeur :</label>
      <select id="factionFilter" class="form-control">
        <option value="">Tous</option>
        <option value="Nintendo">Nintendo</option>
        <option value="PlayStation">PlayStation</option>
        <option value="SEGA">SEGA</option>
        <option value="Xbox">Xbox</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="universeFilter">Univers :</label>
      <select id="universeFilter" class="form-control">
        <option value="">Tous</option>
        <option value="Super Mario">Super Mario</option>
        <option value="The Legend of Zelda">The Legend of Zelda</option>
        <option value="Metroid">Metroid</option>
        <option value="Kid Icarus">Kid Icarus</option>
        <option value="Sonic">Sonic</option>
        <option value="Streets of Rage">Streets of Rage</option>
        <option value="Halo">Halo</option>
        <option value="Gears of War">Gears of War</option>
      </select>
    </div>
    
    <div class="control-group">
      <label for="tierFilter">Force :</label>
      <select id="tierFilter" class="form-control">
        <option value="">Toutes</option>
        <option value="1">Faible</option>
        <option value="2">Moyen</option>
        <option value="3">Fort</option>
        <option value="4">Unique</option>
      </select>
    </div>
  </div>
  
  <!-- Filtres actifs -->
  <div id="activeFilters" class="active-filters"></div>
  
  <!-- Grille des pièces -->
  <div id="piecesGrid" class="pieces-grid">  </div>
</main>

<script src="public/js/header.js"></script>
<script src="public/data/pieces.js"></script>
<script>
// Les données des pièces sont maintenant importées depuis pieces.js

// Variables globales
let currentSort = 'name';
let currentFilters = {
  faction: '',
  universe: '',
  tier: ''
};

// Fonction pour afficher les pièces
function displayPieces(pieces) {
  const grid = document.getElementById('piecesGrid');
  grid.innerHTML = '';
  
  pieces.forEach(piece => {
    const card = document.createElement('div');
    card.className = 'piece-card';
    
    card.innerHTML = `
      <img src="${piece.image}" alt="${piece.name}" class="piece-image" onerror="this.style.display='none'">
      <div class="piece-name">${piece.name}</div>
      <div class="piece-description">${piece.description}</div>
      <div style="margin-top: 12px;">
        <span class="badge ${piece.faction.toLowerCase()}">${piece.faction}</span>
        <span class="badge">${piece.universe}</span>
        <span class="badge tier">${getTierLabel(piece.tier)}</span>
        <span class="badge cost">${piece.cost} pts</span>
        <span class="badge range">Range ${piece.range}</span>
      </div>
      <div class="moves" style="margin-top: 8px; font-size: 11px; color: var(--text-muted);">
        <strong>Mouvements :</strong> ${getMovesDescription(piece.moves)}
      </div>
    `;
    
    grid.appendChild(card);
  });
}

// Fonction pour obtenir la description des mouvements
function getMovesDescription(moves) {
  if (moves.length === 8) {
    return "Toutes les directions (comme une reine)";
  }
  return `${moves.length} directions possibles`;
}

// Fonction pour obtenir le libellé du tier
function getTierLabel(tier) {
  const labels = {
    1: "Faible",
    2: "Moyen", 
    3: "Fort",
    4: "Unique"
  };
  return labels[tier] || "Inconnu";
}

// Fonction pour obtenir la description du tier
function getTierDescription(tier) {
  const descriptions = {
    1: "Faible - Facile à utiliser",
    2: "Moyen - Équilibré", 
    3: "Fort - Puissant mais coûteux",
    4: "Unique - Légendaire"
  };
  return descriptions[tier] || "Force inconnue";
}

// Fonction pour obtenir la couleur de faction
function getFactionColor(faction) {
  const colors = {
    'Nintendo': '#e60012',
    'PlayStation': '#003087', 
    'SEGA': '#0089cf',
    'Xbox': '#107c10'
  };
  return colors[faction] || '#666';
}

// Fonction pour obtenir la couleur d'univers
function getUniverseColor(universe) {
  const colors = {
    'Super Mario': '#e60012',
    'The Legend of Zelda': '#0066cc',
    'Metroid': '#8b4513',
    'Kid Icarus': '#ffd700',
    'Sonic': '#0089cf',
    'Streets of Rage': '#ff4500',
    'Halo': '#107c10',
    'Gears of War': '#8b4513'
  };
  return colors[universe] || '#666';
}

// Fonction pour appliquer les filtres et le tri
function applyFiltersAndSort() {
  let filteredPieces = [...piecesData];
  
  // Appliquer les filtres
  if (currentFilters.faction) {
    filteredPieces = filteredPieces.filter(piece => piece.faction === currentFilters.faction);
  }
  if (currentFilters.universe) {
    filteredPieces = filteredPieces.filter(piece => piece.universe === currentFilters.universe);
  }
  if (currentFilters.tier) {
    filteredPieces = filteredPieces.filter(piece => piece.tier.toString() === currentFilters.tier);
  }
  
  // Appliquer le tri
  filteredPieces.sort((a, b) => {
    switch(currentSort) {
      case 'name':
        return a.name.localeCompare(b.name);
      case 'cost':
        return a.cost - b.cost;
      case 'tier':
        return a.tier - b.tier;
      case 'faction':
        return a.faction.localeCompare(b.faction);
      case 'universe':
        return a.universe.localeCompare(b.universe);
      default:
        return 0;
    }
  });
  
  displayPieces(filteredPieces);
  updateActiveFilters();
}

// Fonction pour mettre à jour l'affichage des filtres actifs
function updateActiveFilters() {
  const container = document.getElementById('activeFilters');
  container.innerHTML = '';
  
  Object.entries(currentFilters).forEach(([key, value]) => {
    if (value) {
      const tag = document.createElement('div');
      tag.className = 'filter-tag';
      
      // Afficher les bons libellés
      let displayKey = key;
      let displayValue = value;
      
      if (key === 'faction') {
        displayKey = 'Éditeur';
      } else if (key === 'tier') {
        displayKey = 'Force';
        displayValue = getTierLabel(parseInt(value));
      }
      
      tag.innerHTML = `
        ${displayKey}: ${displayValue} 
        <span class="remove" onclick="removeFilter('${key}')">×</span>
      `;
      container.appendChild(tag);
    }
  });
}

// Fonction pour supprimer un filtre
function removeFilter(filterType) {
  currentFilters[filterType] = '';
  document.getElementById(filterType + 'Filter').value = '';
  applyFiltersAndSort();
}

// Fonction pour effacer tous les filtres
function clearAllFilters() {
  currentFilters = { faction: '', universe: '', tier: '' };
  document.getElementById('factionFilter').value = '';
  document.getElementById('universeFilter').value = '';
  document.getElementById('tierFilter').value = '';
  applyFiltersAndSort();
}

// Événements
document.getElementById('sortBy').addEventListener('change', (e) => {
  currentSort = e.target.value;
  applyFiltersAndSort();
});

document.getElementById('factionFilter').addEventListener('change', (e) => {
  currentFilters.faction = e.target.value;
  applyFiltersAndSort();
});

document.getElementById('universeFilter').addEventListener('change', (e) => {
  currentFilters.universe = e.target.value;
  applyFiltersAndSort();
});

document.getElementById('tierFilter').addEventListener('change', (e) => {
  currentFilters.tier = e.target.value;
  applyFiltersAndSort();
});

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  VGBHeader.injectHeader('pieces');
  applyFiltersAndSort();
});
</script>
</body>
</html>